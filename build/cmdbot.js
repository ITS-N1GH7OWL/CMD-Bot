const Discord=require("discord.js"),client=new Discord.Client({disableEveryone:!0}),chalk=require("chalk"),path=require("path"),fs=require("fs-extra"),hastebin=require("hastebin.js"),haste=new hastebin,YAML=require("yaml"),pathCheck=e=>process.cwd()+e,__date=new Date(Date.now()),date=`${__date.getFullYear()}-${__date.getMonth()+1}-${__date.getDate()}`,logger=e=>{fs.appendFileSync(pathCheck(`/logs/${date}.log`),e+"\r\n")};fs.existsSync(pathCheck("/config.yaml"))||(fs.writeFileSync(pathCheck("/config.yaml"),"owners:\n  - 'YOUR_USERID'\n  - 'YOUR PARTNERS USERID (if you have one)'\nbot_token: 'LOGIN TOKEN FOR YOUR BOT'"),console.error(chalk.green("We noticed you were missing a config.yaml file, so we've generated a template one for you! Please modify it with the correct options, then run the executable again")));const config=YAML.parse(fs.readFileSync(pathCheck("/config.yaml"),"utf8")),{exec:exec}=require("child_process"),owners=config.owners;let ownerNames=[];client.on("ready",async()=>{fs.ensureFileSync(pathCheck(`/logs/${date}.log`),e=>{e&&console.log(e)}),logger(`________________________________\nBot started at: (${new Date(Date.now())})`),console.log(chalk.blue("Bot developed by "+chalk.red("itsretr0n (https://github.com/itsretr0n)")+" with help from contribuors on the bots Github repo (https://github.com/itsretr0n/CMD-Bot). For assistance, add me on discord: ITS_N1GH7OWL#6550")),console.log(chalk.green("Cmd Bot Has Successfully Started"));try{await owners.forEach(e=>{ownerNames.push(client.users.get(e).tag)}),console.log(chalk.yellow(`Owners Are: ${ownerNames.join(", ")}`))}catch(e){console.error(chalk.red("An invalid owner ID was provided in the config.yaml file!")),process.exit()}}),client.on("error",e=>logger(e)),client.on("message",async msg=>{if(!msg.content.startsWith("/"))return;const isOwner=owners.includes(msg.author.id),args=msg.content.slice(Object.keys("-").length).trim().split(/ +/g),command=args.shift().toLowerCase();if(!isOwner)return logger(`- User: ${msg.author.tag} (${msg.author.id})\n    x Attempted To Use: /${command}\n    x With Arguements: ${args.join(" ")}`),msg.react("❌");if(msg.react("✅"),"logs"==command||(args[0]?logger(`- User: ${msg.author.tag} (${msg.author.id})\n    + Used: /${command}\n    + With Arguements: ${args.join(" ")}`):logger(`- User: ${msg.author.tag} (${msg.author.id})\n    !! Used: /${command}\n    !! But Didn't Specify Any Arguements`)),"exec"===command){if(!args[0])return msg.channel.send("No command given!");exec(args.join(" "),(e,o,n)=>{function t(e){return(new Discord.RichEmbed).setTitle("Terminal").addField("Input:",`\`\`\`${args.join(" ")}\`\`\``).addField("Output:",String(e)).setColor("RANDOM").setFooter(`Bot managed by: ${ownerNames.join(", ")} | Developed by: ITS_N1GH7OWL#6550 + Contributors on: https://github.com/itsretr0n/CMD-Bot`)}o.length<=1024?msg.channel.send(t(`\`\`\`autohotkey\n${o}\`\`\``)):haste.post(o).then(e=>{msg.channel.send(t(`View here: ${e}`))})})}if("eval"==command){function response(e){return(new Discord.RichEmbed).setTitle("Javascript").addField("Code:",`\`\`\`js\n${args.join(" ")}\`\`\``).addField("Returned:",String(e)).setColor("RANDOM").setFooter(`Bot managed by: ${ownerNames.join(", ")} | Developed by: ITS_N1GH7OWL#6550 + Contributors on: https://github.com/itsretr0n/CMD-Bot`)}try{var result=eval(args.join(" "));return result?msg.channel.send(response(`\`\`\`${result}\`\`\``)):msg.channel.send(response("```Nothing was returned!```"))}catch(e){haste.post(e.stack).then(o=>{msg.channel.send(response(`\`\`\`Error type: ${e.name}\nError message: ${e.message}\`\`\`\nThe bot has fowarded the full error information to your DM's.`)).then(()=>{msg.author.send(`Full error here -> ${o}`)})})}}"logs"==command&&(logger(`- User: ${msg.author.tag} (${msg.author.id})\n    + Used: /${command}\n    + To View This File`),haste.post(fs.readFileSync(pathCheck(`/logs/${date}.log`))).then(e=>{msg.author.send(`>>> Logs can be viewed here: ${e}`)})),"help"==command&&msg.channel.send(">>> **__Commands__**\n**/exec** *<command>* *<..args>*: Executes a command through the command line\n**/eval** *<js code>*: Evaluates any javascript code entered and returns a value/response. The Discord.js library is integrated with the command. __Do not wrap code in codeblock!__\n**/logs**: DM's the bots logs. New logs are generated on a daily basis")}),config.bot_token?client.login(config.bot_token).catch(e=>{console.error(chalk.red(`Token login error: ${e.message}`))}):(console.log(chalk.red("Bot token is missing from YAML file!")),process.exit());